// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: trip.sql

package sqlc

import (
	"context"

	"cloud.google.com/go/civil"
)

const deleteTripByID = `-- name: DeleteTripByID :exec
DELETE
FROM trip
WHERE trip.owner_id = $2
AND id = $1
`

type DeleteTripByIDParams struct {
	ID      int32
	OwnerID int32
}

func (q *Queries) DeleteTripByID(ctx context.Context, arg DeleteTripByIDParams) error {
	_, err := q.db.Exec(ctx, deleteTripByID, arg.ID, arg.OwnerID)
	return err
}

const getTripByID = `-- name: GetTripByID :one
SELECT trip.id, trip.name, trip.start_date, trip.end_date, trip.description, trip.image_url, trip.owner_id
FROM trip
LEFT JOIN permissions p ON trip.id = p.trip_id
WHERE (trip.owner_id = $2 OR p.user_id = $2)
AND id = $1
`

type GetTripByIDParams struct {
	ID     int32
	UserID int32
}

func (q *Queries) GetTripByID(ctx context.Context, arg GetTripByIDParams) (Trip, error) {
	row := q.db.QueryRow(ctx, getTripByID, arg.ID, arg.UserID)
	var i Trip
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.StartDate,
		&i.EndDate,
		&i.Description,
		&i.ImageUrl,
		&i.OwnerID,
	)
	return i, err
}

const getTrips = `-- name: GetTrips :many
SELECT trip.id, trip.name, trip.start_date, trip.end_date, trip.description, trip.image_url, trip.owner_id
FROM trip
LEFT JOIN permissions p ON trip.id = p.trip_id
WHERE trip.owner_id = $1 OR p.user_id = $1
`

func (q *Queries) GetTrips(ctx context.Context, userID int32) ([]Trip, error) {
	rows, err := q.db.Query(ctx, getTrips, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Trip{}
	for rows.Next() {
		var i Trip
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.StartDate,
			&i.EndDate,
			&i.Description,
			&i.ImageUrl,
			&i.OwnerID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const insertTrip = `-- name: InsertTrip :one
INSERT INTO trip (owner_id, name, start_date, end_date, description, image_url)
VALUES ($1, $2, $3, $4, $5, $6)
RETURNING id
`

type InsertTripParams struct {
	OwnerID     int32
	Name        string
	StartDate   civil.Date
	EndDate     civil.Date
	Description *string
	ImageUrl    *string
}

func (q *Queries) InsertTrip(ctx context.Context, arg InsertTripParams) (int32, error) {
	row := q.db.QueryRow(ctx, insertTrip,
		arg.OwnerID,
		arg.Name,
		arg.StartDate,
		arg.EndDate,
		arg.Description,
		arg.ImageUrl,
	)
	var id int32
	err := row.Scan(&id)
	return id, err
}

const updateTrip = `-- name: UpdateTrip :exec
UPDATE trip
SET name        = $3,
    start_date  = $4,
    end_date    = $5,
    description = $6,
    image_url   = $7
WHERE trip.owner_id = $2
AND id = $1
`

type UpdateTripParams struct {
	ID          int32
	OwnerID     int32
	Name        string
	StartDate   civil.Date
	EndDate     civil.Date
	Description *string
	ImageUrl    *string
}

func (q *Queries) UpdateTrip(ctx context.Context, arg UpdateTripParams) error {
	_, err := q.db.Exec(ctx, updateTrip,
		arg.ID,
		arg.OwnerID,
		arg.Name,
		arg.StartDate,
		arg.EndDate,
		arg.Description,
		arg.ImageUrl,
	)
	return err
}
